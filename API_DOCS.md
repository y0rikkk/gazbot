# API –¥–ª—è –§—Ä–æ–Ω—Ç–µ–Ω–¥–µ—Ä–∞

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

```bash
git clone <repository-url>
cd gazbot

# –°–æ–∑–¥–∞–π—Ç–µ .env —Ñ–∞–π–ª
cp .env.example .env
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–û—Ç–∫—Ä–æ–π—Ç–µ `.env` –∏ **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** –∑–∞–ø–æ–ª–Ω–∏—Ç–µ:

```env
# Telegram Bot (–ø–æ–ª—É—á–∏—Ç–µ —É @BotFather)
TELEGRAM_BOT_TOKEN=123456:ABC-DEF...
TELEGRAM_BOT_USERNAME=your_bot_name_bot

# ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é
ADMIN_TELEGRAM_IDS=123456789,987654321
```

### 3. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
docker-compose up -d
```

API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞: **http://localhost:8000**

### 4. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

## üìã –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –ü—É–±–ª–∏—á–Ω—ã–µ (–¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞)

| –ú–µ—Ç–æ–¥  | Endpoint                     | –û–ø–∏—Å–∞–Ω–∏–µ                          |
| ------ | ---------------------------- | --------------------------------- |
| `GET`  | `/api/events/current`        | –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ |
| `POST` | `/api/registrations`         | –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏–µ     |
| `GET`  | `/api/registrations`         | –ü–æ–ª—É—á–∏—Ç—å —Å–≤–æ–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏         |
| `GET`  | `/api/registrations/{id}/qr` | –ü–æ–ª—É—á–∏—Ç—å QR-–∫–æ–¥ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏       |
| `GET`  | `/api/users/me`              | –ü–æ–ª—É—á–∏—Ç—å —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å             |
| `PUT`  | `/api/users/me`              | –û–±–Ω–æ–≤–∏—Ç—å —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å             |

### –ê–¥–º–∏–Ω—Å–∫–∏–µ

| –ú–µ—Ç–æ–¥  | Endpoint                                        | –û–ø–∏—Å–∞–Ω–∏–µ                   |
| ------ | ----------------------------------------------- | -------------------------- |
| `GET`  | `/api/admin/events`                             | –í—Å–µ —Å–æ–±—ã—Ç–∏—è                |
| `POST` | `/api/admin/events`                             | –°–æ–∑–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ            |
| `GET`  | `/api/admin/events/{id}/registrations`          | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ —Å–æ–±—ã—Ç–∏–µ     |
| `POST` | `/api/admin/registrations/bulk_update_statuses` | –ú–∞—Å—Å–æ–≤–æ –æ–¥–æ–±—Ä–∏—Ç—å/–æ—Ç–∫–ª–æ–Ω–∏—Ç—å |
| `POST` | `/api/admin/check-in`                           | –û—Ç–º–µ—Ç–∏—Ç—å –ø—Ä–∏—Ö–æ–¥ –ø–æ QR-–∫–æ–¥—É |

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Telegram Mini App** –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é:

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç Web App –≤ Telegram
2. Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `initData` —Å –ø–æ–¥–ø–∏—Å—å—é
3. –§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–µ—Ä–µ–¥–∞–µ—Ç `initData` –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ: `X-Telegram-Init-Data`
4. API –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –ø–æ–¥–ø–∏—Å—å –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞

```javascript
const response = await fetch("http://localhost:8000/api/users/me", {
  headers: {
    "X-Telegram-Init-Data": window.Telegram.WebApp.initData,
  },
});
```

### DEV MODE (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

–ï—Å–ª–∏ `DEV_MODE=true`, –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –ø—Ä–æ—Å—Ç–æ `telegram_id`:

```javascript
headers: {
  'X-Telegram-Init-Data': '123456789' // –≤–∞—à telegram_id
}
```

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–æ–≤

### –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç

```json
{
  "id": 1,
  "title": "–ì–∞–∑–ø—Ä–æ–º –≤—Å—Ç—Ä–µ—á–∞",
  "event_date": "2025-12-01T18:00:00",
  "location": "–û—Ñ–∏—Å –ì–∞–∑–ø—Ä–æ–º–∞"
}
```

### –û—à–∏–±–∫–∞

```json
{
  "detail": "Event not found"
}
```

## üß™ –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `DEV_MODE=true` –≤ `.env`
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–æ–π `telegram_id` –≤–º–µ—Å—Ç–æ –ø–æ–ª–Ω–æ–≥–æ `initData`
3. –û—Ç–∫—Ä–æ–π—Ç–µ Swagger UI: http://localhost:8000/docs
4. –ù–∞–∂–º–∏—Ç–µ "Authorize" –∏ –≤–≤–µ–¥–∏—Ç–µ —Å–≤–æ–π `telegram_id`

## üîÑ –°—Ç–∞—Ç—É—Å—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

- `pending` - –æ–∂–∏–¥–∞–µ—Ç –æ–¥–æ–±—Ä–µ–Ω–∏—è
- `accepted` - –æ–¥–æ–±—Ä–µ–Ω–∞ (–º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å QR-–∫–æ–¥)
- `declined` - –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞
- `cancelled` - –æ—Ç–º–µ–Ω–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

## üìù –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ—Ä–∞

### 1. –î–∞—Ç—ã

–í—Å–µ –¥–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ ISO 8601: `2025-12-01T18:00:00`

### 2. QR-–∫–æ–¥—ã

QR-–∫–æ–¥—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –∫–∞–∫ base64 —Å—Ç—Ä–æ–∫–∏:

```json
{
  "qr_code": "data:image/png;base64,iVBORw0KGgoAAAANS..."
}
```

–ú–æ–∂–Ω–æ —Å—Ä–∞–∑—É –≤—Å—Ç–∞–≤–∏—Ç—å –≤ `<img src="...">`.

### 3. –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

```json
{
  "event_id": 1,
  "user_data": {
    "first_name": "–ò–≤–∞–Ω",
    "last_name": "–ò–≤–∞–Ω–æ–≤",
    "telegram_username": "ivan_ivanov",
    "phone_number": "+79991234567",
    "email": "ivan@example.com"
  }
}
```

### 4. CORS

CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤. –í production –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å:

- Telegram Web App domain
- –í–∞—à production –¥–æ–º–µ–Ω

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
# –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
docker-compose logs -f app

# –õ–æ–≥–∏ –ë–î
docker-compose logs -f postgres
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫

```bash
docker-compose restart app
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
docker-compose down
```

### –û—á–∏—Å—Ç–∫–∞ –ë–î

```bash
docker-compose down -v  # —É–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ!
```

## üîß –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –û—à–∏–±–∫–∞ 401 Unauthorized

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–µ—Ä–µ–¥–∞–µ—Ç–µ `X-Telegram-Init-Data` –∑–∞–≥–æ–ª–æ–≤–æ–∫
- –í DEV_MODE –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º telegram_id —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

### –û—à–∏–±–∫–∞ 403 Forbidden

- –î–ª—è –∞–¥–º–∏–Ω—Å–∫–∏—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤–∞—à telegram_id –≤ `ADMIN_TELEGRAM_IDS`

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ PostgreSQL –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω: `docker-compose ps`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker-compose logs postgres`

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ü–æ –≤–æ–ø—Ä–æ—Å–∞–º API –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –±—ç–∫–µ–Ω–¥-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É.

---

**–í–µ—Ä—Å–∏—è API:** 1.0  
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 22.11.2025
