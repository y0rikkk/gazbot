# GAZBOT API

## üöÄ –ü–æ–ª–Ω—ã–π –≥–∞–∑–∏–∫

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

```bash
# –∫–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ
git clone <repository-url>

# –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
cd gazbot

# —Å–æ–∑–¥–∞–µ–º .env —Ñ–∞–π–ª (–º–µ–Ω—è—Ç—å –≤ –Ω–µ–º –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–¥–æ —Ç–∞–∫ –∫–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å –±—É–¥–µ–º —á–µ—Ä–µ–∑ –¥–æ–∫–µ—Ä)
cp .env.example .env
```

### 3. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker

–°–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å–∫–∞–µ–º Docker Desktop –Ω–∞ –∫–æ–º–ø–µ –∏ –ø–æ—Ç–æ–º –ø–∏—à–µ–º –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ (–≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ gazbot –∫–æ–Ω–µ—á–Ω–æ):

```bash
docker-compose up -d
```

–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∂–¥–µ–º (–ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ–ª–≥–æ, –ø–æ—Ç–æ–º –±—É–¥–µ—Ç —Å–µ–∫—É–Ω–¥ 15) –ø–æ–∫–∞ –Ω–µ –±—É–¥–µ—Ç –∫–∞–∫-—Ç–æ —Ç–∞–∫:

```
 ‚úî Service app                Built
 ‚úî Network gazbot_default     Created
 ‚úî Container gazbot_postgres  Healthy
 ‚úî Container gazbot_app       Started
```

API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞: **http://localhost:8000**

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞

–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –≤—Å—ë –ø–æ–ª—É—á–∏–ª–æ—Å—å, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤–æ—Ç —Å—é–¥–∞ –≤–µ–∑–¥–µ –ø–æ –æ—á–µ—Ä–µ–¥–∏ –∏ —Å–º–æ—Ç—Ä–∏–º —á—Ç–æ –¥–æ—Å—Ç—É–ø–Ω–æ:

- Swagger UI: http://localhost:8000/docs - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ReDoc: http://localhost:8000/redoc - —Ç–æ–∂–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (—Å–∞–º —Å–º–æ—Ç—Ä–∏ –∫–∞–∫–∞—è —Ç–µ–±–µ —É–¥–æ–±–Ω–µ–µ)
- Healthcheck: http://localhost:8000/health - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å {"status":"ok","database":"connected"}

### 5. –¢–µ—Å—Ç—ã

–û—á–µ–Ω—å —Å–æ–≤–µ—Ç—É—é 1 —Ä–∞–∑ –ø—Ä–æ–≥–Ω–∞—Ç—å —Ç–µ—Å—Ç—ã –ø–æ—Å–ª–µ –≤—Å–µ—Ö –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ø—É–Ω–∫—Ç–æ–≤ —á—Ç–æ–±—ã —Ç–æ—á–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

```bash
docker exec -it gazbot_app pytest
```

–í—Å—ë –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–µ–ª–µ–Ω–æ–µ –±–µ–∑ –æ—à–∏–±–æ–∫

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (!)

http://localhost:8000/docs –∏ http://localhost:8000/redoc - –æ—á–µ–Ω—å —É–¥–æ–±–Ω–∞—è –¥–æ–∫–∞, –º–Ω–µ –ª–∏—á–Ω–æ –±–æ–ª—å—à–µ –Ω—Ä–∞–≤–∏—Ç—Å—è swagger (–ø–µ—Ä–≤–∞—è). –¢–∞–º –µ—Å—Ç—å –≤—Å–µ, —á—Ç–æ —Ç–µ–±–µ –Ω—É–∂–Ω–æ, –Ω–æ! –ü—Ä–∏–º–µ—Ä—ã –æ—Ç–≤–µ—Ç–æ–≤ –∞–ø–∏—à–∫–∏ —è –≥–µ–Ω–µ—Ä–∏–ª –Ω–µ–π—Ä–æ–Ω–∫–æ–π, —Ç–∞–∫ —á—Ç–æ –µ—Å—Ç—å –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏–π —à–∞–Ω—Å —á—Ç–æ —Ç–∞–º –≥–¥–µ-—Ç–æ –æ—à–∏–±–∫–∞. 99% —á—Ç–æ —Ç–∞–º –≤—Å–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –Ω–æ –µ—Å–ª–∏ —Ç—ã –ø—Ä—è–º —É–≤–µ—Ä–µ–Ω —á—Ç–æ —Ç–∞–º –æ—à–∏–±–∫–∞ - –ø–∏—à–∏

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Telegram Mini App** –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é:

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç Web App –≤ Telegram
2. Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `initData` —Å –ø–æ–¥–ø–∏—Å—å—é
3. –§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–µ—Ä–µ–¥–∞–µ—Ç `initData` –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ: `X-Telegram-Init-Data`
4. API –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –ø–æ–¥–ø–∏—Å—å –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ü–æ—á–∏—Ç–∞–π –ø–æ–¥—Ä–æ–±–Ω–µ–µ –≤ [TELEGRAM_AUTH.md](TELEGRAM_AUTH.md)

### –ù–û!!! –°–µ–π—á–∞—Å –≤–∫–ª—é—á–µ–Ω DEV_MODE

–ï—Å–ª–∏ `DEV_MODE=true`, –Ω–∞–¥–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –ø—Ä–æ—Å—Ç–æ `telegram_id`:

```javascript
headers: {
  'X-Telegram-Init-Data': '123456789' // telegram_id
}
```

–ò –±—ç–∫ –±—É–¥–µ—Ç —Å—á–∏—Ç–∞—Ç—å —á—Ç–æ —ç—Ç–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–ª—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —ç—Ç–∏–º id

–≠—Ç–æ –ø–æ—Ç–æ–º—É —á—Ç–æ —Å–µ–π—á–∞—Å –º—ã –Ω–∏–∫–∞–∫ –Ω–µ –º–æ–∂–µ–º –ø–æ–ª—É—á–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –æ—Ç —Ç–≥ –æ—á–µ–≤

DEV_MODE –º–æ–∂–Ω–æ –≤—ã–∫–ª—é—á–∏—Ç—å, –ø–æ—Å—Ç–∞–≤–∏–≤ `DEV_MODE=false` –≤ .env

## üêõ –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:

```bash
docker-compose ps
```

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –±—ç–∫–∞:

```bash
docker-compose logs -f app
```

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –ë–î:

```bash
docker-compose logs -f postgres
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫

```bash
docker-compose restart app
```

### –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã:

```bash
docker-compose down
```

### –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å volumes (–ë–î –±—É–¥–µ—Ç –æ—á–∏—â–µ–Ω–∞):

```bash
docker-compose down -v
```

### –°–æ–∑–¥–∞—Ç—å backup:

```bash
docker-compose exec postgres pg_dump -U gazbot gazbot_db > backup.sql
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ backup:

```bash
docker-compose exec -T postgres psql -U gazbot gazbot_db < backup.sql
```

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
docker exec gazbot_app printenv
```
