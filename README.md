# GAZBOT API

## üöÄ –ü–æ–ª–Ω—ã–π –≥–∞–∑–∏–∫

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

```bash
# –∫–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ
git clone <repository-url>

# –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
cd gazbot

# —Å–æ–∑–¥–∞–µ–º .env —Ñ–∞–π–ª
cp .env.example .env
```

### 3. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker

–°–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å–∫–∞–µ–º Docker Desktop –Ω–∞ –∫–æ–º–ø–µ –∏ –ø–æ—Ç–æ–º –ø–∏—à–µ–º –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ (–≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ gazbot –∫–æ–Ω–µ—á–Ω–æ):

```bash
docker-compose up -d
```

–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∂–¥–µ–º (–ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ–ª–≥–æ, –ø–æ—Ç–æ–º –±—É–¥–µ—Ç —Å–µ–∫—É–Ω–¥ 15) –ø–æ–∫–∞ –Ω–µ –±—É–¥–µ—Ç –∫–∞–∫-—Ç–æ —Ç–∞–∫:

```
 ‚úî Service app                Built
 ‚úî Network gazbot_default     Created
 ‚úî Container gazbot_postgres  Healthy
 ‚úî Container gazbot_app       Started
```

API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞: **http://localhost:8000**

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞

–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –≤—Å—ë –ø–æ–ª—É—á–∏–ª–æ—Å—å, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤–æ—Ç —Å—é–¥–∞ –≤–µ–∑–¥–µ –ø–æ –æ—á–µ—Ä–µ–¥–∏ –∏ —Å–º–æ—Ç—Ä–∏–º —á—Ç–æ –¥–æ—Å—Ç—É–ø–Ω–æ:

- Swagger UI: http://localhost:8000/docs - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ReDoc: http://localhost:8000/redoc - —Ç–æ–∂–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (—Å–∞–º —Å–º–æ—Ç—Ä–∏ –∫–∞–∫–∞—è —Ç–µ–±–µ —É–¥–æ–±–Ω–µ–µ)
- Healthcheck: http://localhost:8000/health - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å {"status":"ok","database":"connected"}

## üìã –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã - –≥–ø—Ç –Ω–∞–≥–µ–Ω–µ—Ä–∏–ª, —Ö–∑, –º–æ–∂–µ—Ç –ø–æ–ª–µ–∑–Ω–æ –±—É–¥–µ—Ç, –Ω–æ –≤–æ–æ–±—â–µ –≤—Å–µ –µ—Å—Ç—å –≤ –¥–æ–∫–µ

### –ü—É–±–ª–∏—á–Ω—ã–µ

| –ú–µ—Ç–æ–¥  | Endpoint                     | –û–ø–∏—Å–∞–Ω–∏–µ                          |
| ------ | ---------------------------- | --------------------------------- |
| `GET`  | `/api/events/current`        | –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ |
| `POST` | `/api/registrations`         | –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏–µ     |
| `GET`  | `/api/registrations`         | –ü–æ–ª—É—á–∏—Ç—å —Å–≤–æ–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏         |
| `GET`  | `/api/registrations/{id}/qr` | –ü–æ–ª—É—á–∏—Ç—å QR-–∫–æ–¥ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏       |
| `GET`  | `/api/users/me`              | –ü–æ–ª—É—á–∏—Ç—å —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å             |
| `PUT`  | `/api/users/me`              | –û–±–Ω–æ–≤–∏—Ç—å —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å             |

### –ê–¥–º–∏–Ω—Å–∫–∏–µ

| –ú–µ—Ç–æ–¥  | Endpoint                                        | –û–ø–∏—Å–∞–Ω–∏–µ                   |
| ------ | ----------------------------------------------- | -------------------------- |
| `GET`  | `/api/admin/events`                             | –í—Å–µ —Å–æ–±—ã—Ç–∏—è                |
| `POST` | `/api/admin/events`                             | –°–æ–∑–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ            |
| `GET`  | `/api/admin/events/{id}/registrations`          | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ —Å–æ–±—ã—Ç–∏–µ     |
| `POST` | `/api/admin/registrations/bulk_update_statuses` | –ú–∞—Å—Å–æ–≤–æ –æ–¥–æ–±—Ä–∏—Ç—å/–æ—Ç–∫–ª–æ–Ω–∏—Ç—å |
| `POST` | `/api/admin/check-in`                           | –û—Ç–º–µ—Ç–∏—Ç—å –ø—Ä–∏—Ö–æ–¥ –ø–æ QR-–∫–æ–¥—É |

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Telegram Mini App** –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é:

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç Web App –≤ Telegram
2. Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `initData` —Å –ø–æ–¥–ø–∏—Å—å—é
3. –§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–µ—Ä–µ–¥–∞–µ—Ç `initData` –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ: `X-Telegram-Init-Data`
4. API –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –ø–æ–¥–ø–∏—Å—å –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ü–æ—á–∏—Ç–∞–π –ø–æ–¥—Ä–æ–±–Ω–µ–µ –≤ [TELEGRAM_AUTH.md](TELEGRAM_AUTH.md)

### –ù–û!!! –°–µ–π—á–∞—Å –≤–∫–ª—é—á–µ–Ω DEV_MODE

–ï—Å–ª–∏ `DEV_MODE=true`, –Ω–∞–¥–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –ø—Ä–æ—Å—Ç–æ `telegram_id`:

```javascript
headers: {
  'X-Telegram-Init-Data': '123456789' // telegram_id
}
```

–ò –±—ç–∫ –±—É–¥–µ—Ç —Å—á–∏—Ç–∞—Ç—å —á—Ç–æ —ç—Ç–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–ª—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —ç—Ç–∏–º id

–≠—Ç–æ –ø–æ—Ç–æ–º—É —á—Ç–æ —Å–µ–π—á–∞—Å –º—ã –Ω–∏–∫–∞–∫ –Ω–µ –º–æ–∂–µ–º –ø–æ–ª—É—á–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –æ—Ç —Ç–≥ –æ—á–µ–≤

DEV_MODE –º–æ–∂–Ω–æ –≤—ã–∫–ª—é—á–∏—Ç—å, –ø–æ—Å—Ç–∞–≤–∏–≤ `DEV_MODE=false` –≤ .env

## üêõ –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:

```bash
docker-compose ps
```

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –±—ç–∫–∞:

```bash
docker-compose logs -f app
```

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –ë–î:

```bash
docker-compose logs -f postgres
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫

```bash
docker-compose restart app
```

### –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã:

```bash
docker-compose down
```

### –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å volumes (–ë–î –±—É–¥–µ—Ç –æ—á–∏—â–µ–Ω–∞):

```bash
docker-compose down -v
```

### –°–æ–∑–¥–∞—Ç—å backup:

```bash
docker-compose exec postgres pg_dump -U gazbot gazbot_db > backup.sql
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ backup:

```bash
docker-compose exec -T postgres psql -U gazbot gazbot_db < backup.sql
```
